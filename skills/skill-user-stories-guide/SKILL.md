---
name: skill-user-stories-guide
description: 用户故事和测试用例编写指南。在编写用户故事文档、定义 API 测试用例、或设计用户行为流程时，使用此指南来确保文档结构清晰、可测试且符合规范。
---

# 用户故事和测试指南规范

本 skill 定义了如何编写用户故事文档以及如何为用户故事编写测试用例。

## 核心概念

**用户故事代表用户在系统中完成某个目标的一连串行为。**

### 用户故事的特点

1. **以用户为中心**：描述用户想要完成什么
2. **行为导向**：描述用户的具体操作步骤
3. **价值驱动**：每个行为都应该为用户创造价值
4. **可测试性**：每个行为都可以通过接口调用进行验证

## 核心规则

### 每个用户行为对应一个接口

**原则：** 将用户的完整操作流程拆分为独立的行为步骤，每个步骤对应一个 API 接口调用。

**示例：用户登录流程**

| 步骤 | 用户行为 | 对应接口 | HTTP 方法 |
|------|----------|----------|-----------|
| 1 | 输入用户名和密码 | `/api/auth/login` | POST |
| 2 | 获取个人信息 | `/api/users/me` | GET |

## 文档格式规范

### 用户故事文档模板

```markdown
# [用户故事标题]

## 用户角色
[描述使用此功能的用户角色]

## 用户目标
[描述用户想要达成的目标]

## 行为流程

### 行为 1：[行为标题]
**描述：** [描述用户的具体行为]
**接口：** `[接口路径]`
**请求方式：** `[HTTP 方法]`

### 行为 2：[行为标题]
**描述：** [描述用户的具体行为]
**接口：** `[接口路径]`
**请求方式：** `[HTTP 方法]`

## 测试用例
[参考测试用例部分]
```

### 测试用例文档模板

每个行为都应该包含以下测试信息：

#### 1. cURL 请求示例

```bash
curl -X [HTTP 方法] \
  'http://api.example.com[接口路径]' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer {token}' \
  -d '{
    [请求体参数]
  }'
```

#### 2. 预期响应

**成功响应：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    [响应数据]
  }
}
```

**失败响应示例：**
```json
{
  "code": 400,
  "message": "错误描述",
  "data": null
}
```

#### 3. 测试场景

| 场景描述 | 请求参数 | 预期结果 |
|----------|----------|----------|
| 正常场景 | [正常参数] | 返回成功响应 |
| 参数缺失 | [缺失必要参数] | 返回 400 错误 |
| 权限不足 | [无权限的 token] | 返回 401/403 错误 |
| 资源不存在 | [不存在的资源 ID] | 返回 404 错误 |

## 编写指南

### 用户行为拆分原则

- **原子性**：每个行为应该是原子的，不可再分
- **独立性**：每个行为可以独立测试
- **顺序性**：行为之间有明确的先后顺序
- **完整性**：所有行为组合起来完成完整的用户目标

### 测试用例编写要点

- **覆盖正常场景**：最常见的使用情况
- **覆盖异常场景**：各种错误情况
- **边界条件**：参数为空、极值等
- **权限验证**：不同权限级别的访问
- **并发场景**（如适用）：重复提交等

### 响应格式建议

统一使用以下响应格式：

```json
{
  "code": 200,          // 业务状态码
  "message": "success", // 描述信息
  "data": {             // 实际数据
    // ...
  },
  "timestamp": "2026-02-08T10:30:00Z" // 时间戳（可选）
}
```

## 测试执行清单

### 准备阶段
- [ ] 确认测试环境已就绪
- [ ] 准备测试数据
- [ ] 获取测试用的认证 token（如需要）

### 执行阶段
- [ ] 按照用户故事的顺序执行每个行为
- [ ] 记录每个接口的响应时间
- [ ] 捕获响应数据用于后续行为
- [ ] 测试所有列出的测试场景

### 验证阶段
- [ ] 验证响应状态码是否正确
- [ ] 验证响应数据结构是否符合预期
- [ ] 验证业务逻辑是否正确
- [ ] 验证错误处理是否合理

## 常见问题

### Q1: 如果一个用户行为需要调用多个接口怎么办？

**A:** 重新审视行为拆分，确保每个行为是原子的。如果确实需要多个接口，考虑：
- 是否可以将多个接口合并为一个
- 或者将行为进一步拆分为更细粒度的步骤

### Q2: 如何处理需要后端处理的异步操作？

**A:** 在文档中明确说明：
- 操作是异步的
- 如何查询操作状态（提供一个状态查询接口）
- 预期的完成时间范围

### Q3: 测试用例需要覆盖所有可能的错误场景吗？

**A:** 优先覆盖：
- 最常见的错误场景
- 业务逻辑上重要的错误场景
- 安全相关的错误场景

其他边缘场景可以根据时间和资源选择性覆盖。
